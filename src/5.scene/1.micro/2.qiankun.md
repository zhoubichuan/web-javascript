---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的vuepress学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 二.qiankun

## 1.主应用编写

```html
<el-menu :router="true" mode="horizontal">
  <el-menu-item index="/">首页</el-menu-item>
  <el-menu-item index="/vue">vue应用</el-menu-item>
  <el-menu-item index="/react">react应用</el-menu-item>
</el-menu>
<router-view v-show="$route.name"></router-view>
<div v-show="!$route.name" id="vue"></div>
<div v-show="!$route.name" id="react"></div>
```

## 2.注册子应用

```js
import { registerMicroApps, start } from "qiankun"
const apps = [
  {
    name: "vueApp",
    entry: "//localhost:10000",
    container: "#vue",
    activeRule: "/vue",
  },
  {
    name: "reactApp",
    entry: "//localhost:20000",
    container: "#react",
    activeRule: "/react",
  },
]
registerMicroApps(apps)
start()
```

## 3.子 Vue 应用

```js
let instance = null
function render() {
  instance = new Vue({
    router,
    render: (h) => h(App),
  }).$mount("#app")
}
if (window.__POWERED_BY_QIANKUN__) {
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__
}
if (!window.__POWERED_BY_QIANKUN__) {
  render()
}
export async function bootstrap() {}
export async function mount(props) {
  render()
}
export async function unmount() {
  instance.$destroy()
}
```

- 打包配置

```js
module.exports = {
  devServer: {
    port: 10000,
    headers: {
      "Access-Control-Allow-Origin": "*",
    },
  },
  configureWebpack: {
    output: {
      library: "vueApp",
      libraryTarget: "umd",
    },
  },
}
```

## 4.子 React 应用

```js
import React from "react"
import ReactDOM from "react-dom"
import "./index.css"
import App from "./App"
function render() {
  ReactDOM.render(
    <React.StrictMode>
      <App />
    </React.StrictMode>,
    document.getElementById("root")
  )
}
if (!window.__POWERED_BY_QIANKUN__) {
  render()
}
export async function bootstrap() {}
export async function mount() {
  render()
}
export async function unmount() {
  ReactDOM.unmountComponentAtNode(document.getElementById("root"))
}
```

- 重写 react 中的 webpack 配置文件 (config-overrides.js)

```bash
yarn add react-app-rewired --save-dev
```

```js
module.exports = {
  webpack: (config) => {
    config.output.library = `reactApp`
    config.output.libraryTarget = "umd"
    config.output.publicPath = "http://localhost:20000/"
    return config
  },
  devServer: function(configFunction) {
    return function(proxy, allowedHost) {
      const config = configFunction(proxy, allowedHost)
      config.headers = {
        "Access-Control-Allow-Origin": "*",
      }
      return config
    }
  },
}
```

- 配置.env 文件

```js
PORT = 20000
WDS_SOCKET_PORT = 20000
```

- React 路由配置

```js
import { BrowserRouter, Route, Link } from "react-router-dom"
const BASE_NAME = window.__POWERED_BY_QIANKUN__ ? "/react" : ""
function App() {
  return (
    <BrowserRouter basename={BASE_NAME}>
      <Link to="/">首页</Link>
      <Link to="/about">关于</Link>
      <Route path="/" exact render={() => <h1>hello home</h1>}></Route>
      <Route path="/about" render={() => <h1>hello about</h1>}></Route>
    </BrowserRouter>
  )
}
```
