(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{493:function(t,s,a){"use strict";a.r(s);var r=a(2),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"九-事件环"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#九-事件环"}},[t._v("#")]),t._v(" 九.事件环")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("前言")]),t._v(" "),s("p",[t._v("事件循环中的异步队列有两种：macro（宏任务）队列和 micro（微任务）队列")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("macro-task")]),t._v("：常见的有 setTimeout、setInterval、 setImmediate、script（整体代码）、 I/O 操作、UI 渲染等。")]),t._v(" "),s("li",[s("code",[t._v("micro-task")]),t._v("：常见的有 process.nextTick、Promise、MutationObserver 等。")])])]),t._v(" "),s("h2",{attrs:{id:"_1-event-loop-过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-event-loop-过程"}},[t._v("#")]),t._v(" 1.Event Loop 过程")]),t._v(" "),s("ul",[s("li",[t._v("初始状态：调用栈空。micro 队列空，macro 队列里有且只有一个 script 脚本（整体代码）。")]),t._v(" "),s("li",[t._v("全局上下文（script 标签）被推入调用栈，同步代码执行。在执行的过程中，通过对一些接口的调用，可以产生新的 macro-task 与 micro-task，它们会分别被推入各自的任务队列里。同步代码执行完了，script 脚本会被移出 macro 队列，"),s("strong",[t._v("这个过程本质上是队列的 macro-task 的执行和出队的过程")]),t._v("。")]),t._v(" "),s("li",[t._v("接着处理的是 micro-task。但需要注意的是：当 macro-task 出队时，任务是"),s("strong",[t._v("一个一个")]),t._v("执行的；而 micro-task 出队时，任务是"),s("strong",[t._v("一队一队")]),t._v("执行的。因此，我们处理 micro 队列这一步，会逐个执行队列中的任务并把它出队，直到队列被清空。")]),t._v(" "),s("li",[s("strong",[t._v("执行渲染操作，更新界面")])]),t._v(" "),s("li",[t._v("检查是否存在 Web worker 任务，如果有，则对其进行处理")])]),t._v(" "),s("p",[t._v("（上述过程循环往复，直到两个队列都清空）")]),t._v(" "),s("h2",{attrs:{id:"_2-渲染的时机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-渲染的时机"}},[t._v("#")]),t._v(" 2.渲染的时机")]),t._v(" "),s("p",[t._v("假如我想要在异步任务里进行 DOM 更新，我该把它包装成 micro 还是 macro 呢")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// macro：script --\x3e micro --\x3e render --\x3e macro --\x3e render")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("Promise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// micro：script --\x3e micro --\x3e render")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("对比发现，"),s("strong",[t._v("当我们需要在异步任务中实现 DOM 修改时，把它包装成 micro 任务是相对明智的选择")])])])}),[],!1,null,null,null);s.default=e.exports}}]);